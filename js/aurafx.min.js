!function(){const t=(t,e=document)=>e.querySelector(t),e=(t,e=document)=>Array.from(e.querySelectorAll(t)),n=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)");let o=!0;const a=t("#themeBtn"),r=t("#themeLabel");function s(t){document.documentElement.setAttribute("data-theme",t),localStorage.setItem("aurafx-theme",t),r&&(r.textContent=t[0].toUpperCase()+t.slice(1))}s(function(){const t=localStorage.getItem("aurafx-theme");return t||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}()),a?.addEventListener("click",()=>{s("light"===(document.documentElement.getAttribute("data-theme")||"light")?"dark":"light"),Z({tone:"info",title:"Theme",desc:`Switched to ${document.documentElement.getAttribute("data-theme")}.`})});const i=t("#cursorBtn"),c=t("#cursorLabel");function d(t){document.documentElement.setAttribute("data-cursor",t),localStorage.setItem("aurafx-cursor",t),c&&(c.textContent="custom"===t?"Cursor: FX":"Cursor: System")}d(localStorage.getItem("aurafx-cursor")||"system"),i?.addEventListener("click",()=>{d("system"===(document.documentElement.getAttribute("data-cursor")||"system")?"custom":"system"),Z({tone:"info",title:"Cursor",desc:`Mode: ${document.documentElement.getAttribute("data-cursor")}.`})});const l=t("#cursor");let u=innerWidth/2,m=innerHeight/2,f=u,h=m;document.addEventListener("mousemove",t=>{f=t.clientX,h=t.clientY}),function t(){u+=.18*(f-u),m+=.18*(h-m),l&&(l.style.left=u+"px",l.style.top=m+"px"),requestAnimationFrame(t)}(),e(".ix,button,a,input,textarea,select").forEach(t=>{t.addEventListener("mouseenter",()=>document.body.classList.add("hov")),t.addEventListener("mouseleave",()=>document.body.classList.remove("hov"))});const y=t("#prog"),p=t("#nav");function g(){const t=Math.max(1,document.documentElement.scrollHeight-innerHeight);y&&(y.style.width=scrollY/t*100+"%"),p&&p.classList.toggle("scrolled",scrollY>40)}addEventListener("scroll",g,{passive:!0}),g();const v=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&t.target.classList.add("vis")})},{threshold:.12});e(".rv,.rv-r,.rv-l,.rv-s,.stg").forEach(t=>v.observe(t));const b=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.querySelectorAll(".counter").forEach(t=>{const e=+t.dataset.v;let n=0;const o=Math.max(1,Math.floor(e/30)),a=setInterval(()=>{n+=o,n>=e&&(n=e,clearInterval(a)),t.textContent=n},40)}),b.unobserve(t.target))})},{threshold:.5}),x=t("#stats");x&&b.observe(x),e(".card-spot").forEach(t=>{t.addEventListener("mousemove",e=>{const n=t.getBoundingClientRect();t.style.setProperty("--mx",e.clientX-n.left+"px"),t.style.setProperty("--my",e.clientY-n.top+"px")})});const E=t("#flow-canvas"),k=E?.getContext("2d");let A=0,w=0,L=[],C=null,S=0,M=!1;function q(){if(!E||!k)return;A=innerWidth,w=innerHeight,E.width=A,E.height=w,L=[];for(let t=0;t<58;t++)L.push({x:Math.random()*A,y:Math.random()*w,r:1.8*Math.random()+.5,vx:.32*(Math.random()-.5),vy:.32*(Math.random()-.5),a:.35*Math.random()+.08})}function I(){if(!E||!k)return;if(!M)return void(C=null);if(C=requestAnimationFrame(I),S=(S+1)%2,0!==S)return;k.clearRect(0,0,A,w);const t="dark"===document.documentElement.getAttribute("data-theme")?"139,92,246":"37,99,235";for(const e of L)e.x+=e.vx,e.y+=e.vy,(e.x<0||e.x>A)&&(e.vx*=-1),(e.y<0||e.y>w)&&(e.vy*=-1),k.beginPath(),k.arc(e.x,e.y,e.r,0,2*Math.PI),k.fillStyle=`rgba(${t},${e.a})`,k.fill();for(let e=0;e<L.length;e++)for(let n=e+1;n<L.length;n++){const o=L[e].x-L[n].x,a=L[e].y-L[n].y,r=Math.sqrt(o*o+a*a);r<110&&(k.beginPath(),k.moveTo(L[e].x,L[e].y),k.lineTo(L[n].x,L[n].y),k.strokeStyle=`rgba(${t},${.06*(1-r/110)})`,k.stroke())}}function T(){E&&k&&(!function(){const t=!(!n||!n.matches);return o&&!t}()?M=!1:M||(M=!0,C||I()))}function $(){M=!1,C&&(cancelAnimationFrame(C),C=null)}addEventListener("resize",()=>{q()},{passive:!0}),document.addEventListener("visibilitychange",()=>{document.hidden?$():T()}),q(),T();const D=t("#toastRoot");function H(t){return String(t??"").replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}function Z({tone:t="info",title:e="Notice",desc:n="",timeout:o=2600}){if(!D)return;const a=document.createElement("div");a.className="toast",a.setAttribute("data-tone",t),a.innerHTML=`\n      <div class="ic">${"ok"===t?"✓":"warn"===t?"!":"bad"===t?"×":"i"}</div>\n      <div>\n        <div class="t">${H(e)}</div>\n        <div class="d">${H(n)}</div>\n      </div>\n      <button class="close" type="button" aria-label="Close toast">✕</button>\n    `,D.appendChild(a);const r=()=>a.remove();a.querySelector(".close").addEventListener("click",r),o>0&&setTimeout(r,o)}let F=null;function N(t){if(!t)return[];const n=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(",");return e(n,t).filter(t=>{const e=getComputedStyle(t);return"hidden"!==e.visibility&&"none"!==e.display})}function R(e){const n="string"==typeof e?t(e):e;if(!n)return;F=document.activeElement,n.setAttribute("data-state","open"),document.body.style.overflow="hidden";const o=N(n)[0]||n.querySelector(".panel");setTimeout(()=>o?.focus?.(),0),n._trapHandler=t=>{if("Tab"!==t.key)return;const e=N(n);if(0===e.length)return;const o=e[0],a=e[e.length-1];t.shiftKey&&document.activeElement===o?(t.preventDefault(),a.focus()):t.shiftKey||document.activeElement!==a||(t.preventDefault(),o.focus())},document.addEventListener("keydown",n._trapHandler,!0)}function _(t){t&&(t.setAttribute("data-state","closed"),document.body.style.overflow="",t._trapHandler&&(document.removeEventListener("keydown",t._trapHandler,!0),t._trapHandler=null),setTimeout(()=>F?.focus?.(),0))}function K(t,n){const o=t?.querySelector('[data-af="menu-panel"]'),a=t?.querySelector('[data-af="menu-toggle"]');if(!o||!a)return;o.setAttribute("data-state",n?"open":"closed"),a.setAttribute("aria-expanded",n?"true":"false");const r=e(".menu-item",o);if(r.forEach(t=>t.removeAttribute("data-active")),n){const t=r[0];t&&(t.setAttribute("data-active","true"),t.tabIndex=0,r.slice(1).forEach(t=>t.tabIndex=-1),t.focus())}}function P(t,n){const o=e(".menu-item",t);if(0===o.length)return;let a=o.findIndex(t=>"true"===t.getAttribute("data-active"));a<0&&(a=0),o[a].removeAttribute("data-active"),a=(a+n+o.length)%o.length,o.forEach(t=>t.tabIndex=-1),o[a].setAttribute("data-active","true"),o[a].tabIndex=0,o[a].focus()}function X(n){e('#ctabs [role="tab"]').forEach(t=>{const e=t.dataset.tab===n;t.setAttribute("aria-selected",e?"true":"false"),t.tabIndex=e?0:-1}),["pt","np","fm"].forEach(e=>{const o=t("#tab-"+e);o&&o.setAttribute("data-state",e===n?"open":"closed")})}function z(){e('[data-af="acc"]').forEach(t=>{const e=t.querySelector(".acc-body");e&&("open"===t.getAttribute("data-state")?e.style.height=e.scrollHeight+"px":e.style.height="0px")})}t("#ctabs")?.addEventListener("keydown",t=>{["ArrowRight","ArrowLeft","Home","End"].includes(t.key)&&function(t){const n=e('#ctabs [role="tab"]');if(0===n.length)return;const o=document.activeElement,a=n.indexOf(o);if(a<0)return;let r=a;"ArrowRight"===t.key&&(r=(a+1)%n.length),"ArrowLeft"===t.key&&(r=(a-1+n.length)%n.length),"Home"===t.key&&(r=0),"End"===t.key&&(r=n.length-1),r!==a&&(t.preventDefault(),n[r].focus(),X(n[r].dataset.tab))}(t)}),addEventListener("resize",z,{passive:!0}),setTimeout(z,0);const O={toast:t=>{Z({tone:t.getAttribute("data-tone")||"info",title:t.getAttribute("data-title")||"Notice",desc:t.getAttribute("data-desc")||""})},"modal-open":t=>{R(t.getAttribute("data-target"))},"modal-close":t=>{_(t.closest('[data-af="modal"]'))},"menu-toggle":t=>{const e=t.closest(".menu"),n=e?.querySelector('[data-af="menu-panel"]');K(e,!("open"===n?.getAttribute("data-state")))},tab:t=>{const e=t.getAttribute("data-tab");e&&X(e)},acc:t=>{const e=t.closest('[data-af="acc"]');if(!e)return;"open"===e.getAttribute("data-state")?function(t){const e=t.querySelector(".acc-body");if(!e)return;e.style.height=e.scrollHeight+"px",requestAnimationFrame(()=>{e.style.height="0px"}),t.setAttribute("data-state","closed");const n=t.querySelector(".acc-h");n?.setAttribute("aria-expanded","false")}(e):function(t){const e=t.querySelector(".acc-body");if(!e)return;e.style.height=e.scrollHeight+"px",t.setAttribute("data-state","open");const n=t.querySelector(".acc-h");n?.setAttribute("aria-expanded","true")}(e)},pulse:()=>{const e=t("#sig-dot");if(!e)return;e.style.opacity=1;const n=[{x:60,y:280},{x:120,y:225},{x:148,y:210},{x:148,y:158},{x:148,y:128},{x:148,y:98},{x:148,y:83},{x:250,y:60},{x:318,y:42},{x:318,y:8}];let o=0;const a=setInterval(()=>{if(o>=n.length)return clearInterval(a),void(e.style.opacity=0);e.setAttribute("cx",n[o].x),e.setAttribute("cy",n[o].y),o++},110)},"demo-loading":()=>{t("#skeletonZone").style.display="",t("#tableZone").style.display="none",t("#emptyZone").style.display="none",Z({tone:"info",title:"Loading",desc:"Skeleton shown."})},"demo-empty":()=>{t("#emptyZone").style.display="",t("#tableZone").style.display="none",t("#skeletonZone").style.display="none",Z({tone:"warn",title:"Empty",desc:"Empty state shown."})},"demo-table":()=>{t("#tableZone").style.display="",t("#skeletonZone").style.display="none",t("#emptyZone").style.display="none",Z({tone:"ok",title:"Ready",desc:"Table shown."})},"chip-close":t=>{t.closest("[data-af-chip]")?.remove?.(),t.closest(".flex")?.remove?.(),Z({tone:"info",title:"Chip removed",desc:"(demo)"})},"anim-toggle":t=>{o=!!t.checked,o?T():$(),Z({tone:"info",title:"Animations",desc:o?"Enabled":"Disabled"})},"theme-toggle":()=>{},"cursor-toggle":()=>{}};function Y(t){const e=t.closest?.("[data-af]");if(!e)return!1;const n=e.getAttribute("data-af"),o=O[n];return"function"==typeof o&&(o(e),!0)}document.addEventListener("click",t=>{if(Y(t.target))return;const e=t.target.closest(".menu-item");if(e){const t=e.closest(".menu");t&&K(t,!1)}}),document.addEventListener("keydown",t=>{if("Escape"===t.key){const t=e('[data-af="modal"][data-state="open"]').pop();return t?void _(t):void e('.menu-panel[data-state="open"]').forEach(t=>{const e=t.closest(".menu");e&&K(e,!1)})}const n=t.target.closest?.('.menu-panel[data-state="open"]');if(n&&("ArrowDown"===t.key&&(t.preventDefault(),P(n,1)),"ArrowUp"===t.key&&(t.preventDefault(),P(n,-1)),"Enter"===t.key||" "===t.key)){t.preventDefault();const e=n.querySelector('.menu-item[data-active="true"]')||n.querySelector(".menu-item");if(e){Y(e);const t=n.closest(".menu");t&&K(t,!1)}}const o=t.target.closest?.(".acc-h");!o||"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),O.acc(o))}),document.addEventListener("pointerdown",t=>{e('.menu-panel[data-state="open"]').forEach(e=>{const n=e.closest(".menu");n&&!n.contains(t.target)&&K(n,!1)})});const B=[{t:"Function Signature",d:"Defines attention(q,k,v) with Q/K/V matrices."},{t:"Dimension",d:"Extract d_k — key dimension used for scaling."},{t:"Raw Scores",d:"Dot product Q×Kᵀ gives similarity logits."},{t:"Scaling",d:"Divide by √d_k to prevent softmax saturation."},{t:"Softmax",d:"Convert logits to probability distribution over keys."},{t:"Output",d:"Weighted sum of V gives context-enriched vectors."}];e("#codeblock .cline").forEach(n=>{n.addEventListener("mouseenter",()=>{e("#codeblock .cline").forEach(t=>t.removeAttribute("data-state")),n.setAttribute("data-state","active");const o=+n.dataset.i;t("#lp-t").textContent=B[o]?.t||"Line",t("#lp-d").textContent=B[o]?.d||""})});const U="The animal didn't cross the street because it was too tired".split(" "),W=t("#tok-area"),Q=t("#sel-w"),V=t("#hgrid"),j=t("#attn-bars"),G=U.length;V.style.gridTemplateColumns=`repeat(${G},1fr)`;for(let t=0;t<G*G;t++){const t=document.createElement("div");t.className="hcell",t.style.cssText="width:22px;height:22px;background:rgba(148,163,184,.14)",V.appendChild(t)}U.forEach((t,n)=>{const o=document.createElement("span");o.className="token ix",o.textContent=t,o.addEventListener("click",()=>function(t){Q.textContent=U[t],e(".token").forEach((e,n)=>e.setAttribute("data-state",n===t?"active":""));const n=e(".hcell",V),o=function(t){const e=[];for(let n=0;n<G;n++)"it"===U[t]&&"animal"===U[n]?e.push(.6):"tired"===U[t]&&"animal"===U[n]?e.push(.35):n===t?e.push(.25+.15*Math.random()):e.push(.12*Math.random());const n=e.reduce((t,e)=>t+e,0);return e.map(t=>t/n)}(t),a="dark"===document.documentElement.getAttribute("data-theme")?"139,92,246":"37,99,235";for(let e=0;e<G;e++){const r=e===t?o:Array.from({length:G},()=>.08*Math.random());for(let t=0;t<G;t++){const o=r[t];n[e*G+t].style.background=`rgba(${a},${Math.min(2.6*o,.92)})`}}j.innerHTML="",o.forEach((e,n)=>{const o=document.createElement("div");o.style.cssText="display:flex;align-items:center;gap:8px;margin-bottom:6px";const a=document.createElement("span");a.style.cssText="font-family:var(--font-mono);font-size:10px;width:60px;text-align:right;color:var(--muted)",a.textContent=U[n];const r=document.createElement("div");r.className="pbar",r.style.cssText="flex:1;height:8px";const s=document.createElement("div");s.className="fill",s.style.width=100*e+"%",s.style.background=n===t?"linear-gradient(90deg,var(--bad),var(--brand2))":"linear-gradient(90deg,var(--brand),var(--brand2))",r.appendChild(s);const i=document.createElement("span");i.style.cssText="font-family:var(--font-mono);font-size:10px;width:40px;color:var(--ink)",i.textContent=(100*e).toFixed(1)+"%",o.appendChild(a),o.appendChild(r),o.appendChild(i),j.appendChild(o)})}(n)),W.appendChild(o)}),window.addEventListener("load",function(){if("function"==typeof renderMathInElement)try{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})}catch(t){}},{once:!0}),document.addEventListener("keydown",t=>{(t.metaKey||t.ctrlKey)&&("m"===t.key.toLowerCase()&&(t.preventDefault(),R("#modal-doc")),"i"===t.key.toLowerCase()&&(t.preventDefault(),Z({tone:"info",title:"AuraFX",desc:"v6 registry + a11y + keyboard UX."})),"e"===t.key.toLowerCase()&&(t.preventDefault(),Z({tone:"ok",title:"Export",desc:"Tokens exported (demo)."})))})}();